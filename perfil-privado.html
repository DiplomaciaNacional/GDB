<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil Privado - GDB Beni</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ESTILOS ESPEC√çFICOS PARA PERFIL PRIVADO */
        .perfil-privado-header {
            background: linear-gradient(135deg, var(--dark-green), #004d00);
            color: white;
            padding: 20px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .perfil-privado-header h1 {
            color: white;
            font-size: 1.5rem;
            margin: 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            color: var(--dark-green);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .logout-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .perfil-privado-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .perfil-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 10px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 25px;
            background: none;
            border: none;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            color: var(--medium-gray);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--burgundy);
            background-color: rgba(139, 0, 0, 0.05);
        }

        .tab-btn.active {
            color: var(--dark-green);
            border-bottom: 3px solid var(--dark-green);
            background-color: rgba(0, 100, 0, 0.05);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .perfil-card {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .perfil-header {
            display: flex;
            gap: 30px;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
        }

        .perfil-avatar-grande {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--dark-green);
            border: 5px solid var(--gold);
        }

        .perfil-datos h2 {
            color: var(--dark-green);
            margin-bottom: 10px;
            text-align: left;
        }

        .perfil-datos h2::after {
            display: none;
        }

        .perfil-titulo {
            color: var(--burgundy);
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .datos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dato-item {
            background-color: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--burgundy);
        }

        .dato-label {
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dato-valor {
            color: var(--dark-green);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .seccion-titulo {
            color: var(--dark-green);
            margin: 30px 0 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .seccion-titulo i {
            color: var(--gold);
        }

        .lista-datos {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .lista-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background-color: var(--light-gray);
            border-radius: 8px;
            transition: var(--transition);
        }

        .lista-item:hover {
            background-color: rgba(139, 0, 0, 0.05);
            transform: translateX(5px);
        }

        .lista-icono {
            color: var(--burgundy);
            font-size: 1.2rem;
            width: 30px;
            text-align: center;
        }

        /* ESTILOS PARA FORMULARIOS DE EDICI√ìN */
        .form-edicion {
            background-color: var(--light-gray);
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .form-fila {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-fila {
                grid-template-columns: 1fr;
            }
        }

        .botones-accion {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-editar {
            background-color: var(--gold);
            color: var(--dark-gray);
        }

        .btn-guardar {
            background-color: var(--dark-green);
            color: white;
        }

        .btn-cancelar {
            background-color: var(--medium-gray);
            color: white;
        }

        /* ANIMACIONES */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ESTAD√çSTICAS */
        .estadisticas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .estadistica-item {
            background: linear-gradient(135deg, var(--dark-green), #004d00);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .estadistica-numero {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .estadistica-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .perfil-header {
                flex-direction: column;
                text-align: center;
            }

            .perfil-tabs {
                flex-wrap: wrap;
            }

            .perfil-privado-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                padding: 15px 5%;
            }
        }

        /* Agrega al final de tu <style> */
        .notificacion-flotante {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }

        .notificacion-flotante.success {
            background: var(--dark-green);
            color: white;
        }

        .notificacion-flotante.error {
            background: #d32f2f;
            color: white;
        }

        .notificacion-flotante.info {
            background: #2196F3;
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <!-- ENCABEZADO DEL PERFIL PRIVADO -->
    <header class="perfil-privado-header">
        <h1><i class="fas fa-user-shield"></i> Perfil Privado - GDB Beni</h1>
        <div class="user-info">
            <div class="user-avatar" id="user-avatar">JD</div>
            <div>
                <div id="user-name" style="font-weight: 600;">Cargando...</div>
                <div style="font-size: 0.8rem; opacity: 0.8;" id="user-email">...</div>
            </div>
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n
            </button>
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="perfil-privado-container">
        <!-- PESTA√ëAS -->
        <div class="perfil-tabs">
            <button class="tab-btn active" data-tab="info">
                <i class="fas fa-user"></i> Informaci√≥n Personal
            </button>
            <button class="tab-btn" data-tab="actividades">
                <i class="fas fa-calendar-check"></i> Mis Actividades
            </button>
            <button class="tab-btn" data-tab="documentos">
                <i class="fas fa-file-alt"></i> Documentos
            </button>
            <button class="tab-btn" data-tab="config">
                <i class="fas fa-cog"></i> Configuraci√≥n
            </button>
        </div>

        <!-- CONTENIDO DE PESTA√ëAS -->

        <!-- PESTA√ëA 1: INFORMACI√ìN PERSONAL -->
        <div class="tab-content active" id="tab-info">
            <div class="perfil-card">
                <div class="perfil-header">
                    <div class="perfil-avatar-grande" id="grand-avatar">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="perfil-datos">
                        <h2 id="full-name">Cargando nombre...</h2>
                        <div class="perfil-titulo" id="user-title">Delegado GDB Beni</div>
                        <div style="color: var(--medium-gray); margin-bottom: 15px;" id="user-id">
                            ID: <span id="display-id">...</span>
                        </div>
                        <button class="btn-primary btn-editar" id="edit-info-btn">
                            <i class="fas fa-edit"></i> Editar Informaci√≥n
                        </button>
                    </div>
                </div>

                <!-- DATOS PERSONALES -->
                <h3 class="seccion-titulo">
                    <i class="fas fa-id-card"></i> Datos Personales
                </h3>
                <div class="datos-grid" id="personal-data">
                    <!-- Los datos se cargar√°n con JavaScript -->
                </div>

                <!-- CONTACTO -->
                <h3 class="seccion-titulo">
                    <i class="fas fa-address-book"></i> Informaci√≥n de Contacto
                </h3>
                <div class="lista-datos" id="contact-data">
                    <!-- Los datos se cargar√°n con JavaScript -->
                </div>

                <!-- ESTAD√çSTICAS -->
                <h3 class="seccion-titulo">
                    <i class="fas fa-chart-line"></i> Mis Estad√≠sticas
                </h3>
                <div class="estadisticas-grid">
                    <div class="estadistica-item">
                        <div class="estadistica-numero" id="stat-events">0</div>
                        <div class="estadistica-label">Eventos Asistidos</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-numero" id="stat-hours">0</div>
                        <div class="estadistica-label">Horas de Voluntariado</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-numero" id="stat-projects">0</div>
                        <div class="estadistica-label">Proyectos Participados</div>
                    </div>
                    <div class="estadistica-item">
                        <div class="estadistica-numero" id="stat-ranking">#0</div>
                        <div class="estadistica-label">Ranking General</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PESTA√ëA 2: ACTIVIDADES -->
        <div class="tab-content" id="tab-actividades">
            <div class="perfil-card">
                <h2><i class="fas fa-calendar-check"></i> Mis Actividades</h2>
                <p style="color: var(--medium-gray); margin-bottom: 30px;">
                    Historial de tu participaci√≥n en eventos GDB
                </p>

                <div id="activities-list">
                    <p style="text-align: center; padding: 40px; color: var(--medium-gray);">
                        <i class="fas fa-spinner fa-spin"></i> Cargando actividades...
                    </p>
                </div>
            </div>
        </div>

        <!-- PESTA√ëA 3: DOCUMENTOS -->
        <div class="tab-content" id="tab-documentos">
            <div class="perfil-card">
                <h2><i class="fas fa-file-alt"></i> Mis Documentos</h2>
                <p style="color: var(--medium-gray); margin-bottom: 30px;">
                    Documentos personales y certificados GDB
                </p>

                <div id="documents-list">
                    <p style="text-align: center; padding: 40px; color: var(--medium-gray);">
                        <i class="fas fa-spinner fa-spin"></i> Cargando documentos...
                    </p>
                </div>
            </div>
        </div>

        <!-- PESTA√ëA 4: CONFIGURACI√ìN -->
        <div class="tab-content" id="tab-config">
            <div class="perfil-card">
                <h2><i class="fas fa-cog"></i> Configuraci√≥n de Cuenta</h2>

                <div class="form-edicion">
                    <h3 style="color: var(--dark-green); margin-bottom: 20px;">
                        <i class="fas fa-lock"></i> Seguridad
                    </h3>

                    <div class="form-fila">
                        <div class="form-group">
                            <label>Contrase√±a Actual</label>
                            <input type="password" id="current-password" placeholder="Ingresa tu contrase√±a actual">
                        </div>
                        <div class="form-group">
                            <label>Nueva Contrase√±a</label>
                            <input type="password" id="new-password" placeholder="M√≠nimo 8 caracteres">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Confirmar Nueva Contrase√±a</label>
                        <input type="password" id="confirm-password" placeholder="Repite la nueva contrase√±a">
                    </div>

                    <div class="botones-accion">
                        <button class="btn-primary btn-guardar" id="save-password-btn">
                            <i class="fas fa-save"></i> Cambiar Contrase√±a
                        </button>
                    </div>
                </div>

                <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid var(--light-gray);">
                    <h3 style="color: var(--burgundy); margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> Zona de Peligro
                    </h3>

                    <button class="btn-primary" id="delete-account-btn" style="background-color: #d32f2f;">
                        <i class="fas fa-trash"></i> Eliminar Mi Cuenta
                    </button>

                    <p style="color: var(--medium-gray); font-size: 0.9rem; margin-top: 15px;">
                        <i class="fas fa-info-circle"></i>
                        Esta acci√≥n eliminar√° permanentemente tu cuenta y todos tus datos.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- MODAL DE EDICI√ìN -->
    <div id="edit-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
        <div
            style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h3 style="color: var(--dark-green); margin-bottom: 20px;">
                <i class="fas fa-edit"></i> Editar Informaci√≥n
            </h3>
            <div id="edit-form-container">
                <!-- Formulario se cargar√° din√°micamente -->
            </div>
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button onclick="cerrarModal()" class="btn-primary btn-cancelar" style="flex: 1;">
                    Cancelar
                </button>
                <button onclick="guardarCambios()" class="btn-primary btn-guardar" style="flex: 1;">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- SCRIPT PRINCIPAL -->
    <script>
        // ============================================
        // CONFIGURACI√ìN GOOGLE SHEETS API
        // ============================================
        const SHEET_ID = '15W3jXoLSyIRVpSlMu2itSxJ8fGoiQgmS6oq5Ie2WjIM'; // Reemplaza con tu ID de Google Sheet
        const API_KEY = 'AIzaSyAQ7uEfcEcN0-0YLC1nhFafL2-uSGaAWUo';   // Reemplaza con tu API Key
        const STORAGE_KEYS = {
            SESSION: 'gdb_session',
            USER_DATA: 'gdb_user_data'
        };

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let usuarioActual = null;
        let datosUsuarioCompletos = null;

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('üöÄ Perfil privado inicializado');

            // 1. Verificar sesi√≥n
            if (!verificarSesion()) {
                window.location.href = 'login.html?auth_required=true';
                return;
            }

            // 2. Cargar datos del usuario DESDE GOOGLE SHEETS
            await cargarDatosDesdeSheets();

            // 3. Configurar eventos
            configurarEventos();

            // 4. Inicializar pesta√±as
            inicializarTabs();
        });

        // ============================================
        // FUNCIONES DE SESI√ìN (MANTENER IGUAL)
        // ============================================
        function verificarSesion() {
            try {
                const sesionStr = localStorage.getItem(STORAGE_KEYS.SESSION) ||
                    sessionStorage.getItem(STORAGE_KEYS.SESSION);

                if (!sesionStr) {
                    console.log('‚ùå No hay sesi√≥n activa');
                    return false;
                }

                const sesion = JSON.parse(sesionStr);

                // Verificar expiraci√≥n
                if (sesion.expiracion && Date.now() > sesion.expiracion) {
                    console.log('‚åõ Sesi√≥n expirada');
                    limpiarSesion();
                    return false;
                }

                usuarioActual = sesion;
                console.log('‚úÖ Sesi√≥n activa para:', usuarioActual.email);
                return true;

            } catch (error) {
                console.error('‚ùå Error verificando sesi√≥n:', error);
                limpiarSesion();
                return false;
            }
        }

        function limpiarSesion() {
            localStorage.removeItem(STORAGE_KEYS.SESSION);
            sessionStorage.removeItem(STORAGE_KEYS.SESSION);
            localStorage.removeItem(STORAGE_KEYS.USER_DATA);
            usuarioActual = null;
            datosUsuarioCompletos = null;
        }

        function cerrarSesion() {
            mostrarNotificacion('Cerrando sesi√≥n...', 'info');
            limpiarSesion();
            setTimeout(() => {
                window.location.href = 'login.html?logout=true';
            }, 1000);
        }

        // ============================================
        // CARGA DE DATOS DESDE GOOGLE SHEETS API
        // ============================================
        async function cargarDatosDesdeSheets() {
            if (!usuarioActual) return;

            mostrarLoading('Conectando a Google Sheets...');

            try {
                console.log('üìä Buscando usuario ID:', usuarioActual.id);

                // 1. Obtener datos de la hoja "Credenciales"
                const credencialesUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Credenciales!A:I?key=${API_KEY}`;
                const credencialesResponse = await fetch(credencialesUrl);

                if (!credencialesResponse.ok) {
                    throw new Error(`Error Sheets API: ${credencialesResponse.status}`);
                }

                const credencialesData = await credencialesResponse.json();
                const credencialesRows = credencialesData.values || [];

                // 2. Buscar usuario por ID
                let usuarioEncontrado = null;
                for (let i = 1; i < credencialesRows.length; i++) {
                    const row = credencialesRows[i];
                    if (row[0] == usuarioActual.id) { // Columna A = ID
                        usuarioEncontrado = {
                            id: row[0],
                            email: row[1],
                            tipo: row[4] || 'delegado',
                            activo: row[5] === 'TRUE' || row[5] === true,
                            fechaRegistro: row[6],
                            ultimoAcceso: row[7]
                        };
                        break;
                    }
                }

                if (!usuarioEncontrado) {
                    throw new Error('Usuario no encontrado en Sheets');
                }

                // 3. Obtener nombre e iniciales
                usuarioEncontrado.nombre = extraerNombreDesdeEmail(usuarioEncontrado.email);
                usuarioEncontrado.iniciales = obtenerIniciales(usuarioEncontrado.nombre);

                // 4. Intentar obtener detalles adicionales
                try {
                    const detalles = await obtenerDetallesDesdeSheets(usuarioActual.id);
                    usuarioEncontrado = { ...usuarioEncontrado, ...detalles };
                } catch (detallesError) {
                    console.warn('‚ö†Ô∏è No se pudieron cargar detalles:', detallesError.message);
                }

                // 5. Asignar datos
                datosUsuarioCompletos = usuarioEncontrado;
                mostrarDatosUsuario(datosUsuarioCompletos);

                // 6. Guardar en cach√©
                localStorage.setItem(STORAGE_KEYS.USER_DATA, JSON.stringify(datosUsuarioCompletos));

                console.log('‚úÖ Datos reales cargados desde Google Sheets');
                mostrarNotificacion('‚úÖ Perfil actualizado', 'success');

            } catch (error) {
                console.error('‚ùå Error cargando desde Sheets:', error);

                // Fallback a cach√©
                const datosCache = localStorage.getItem(STORAGE_KEYS.USER_DATA);
                if (datosCache) {
                    console.log('üìÇ Usando datos en cach√©');
                    datosUsuarioCompletos = JSON.parse(datosCache);
                    mostrarDatosUsuario(datosUsuarioCompletos);
                    mostrarNotificacion('‚ö†Ô∏è Datos en cach√© (sin conexi√≥n)', 'warning');
                } else {
                    console.log('‚ö†Ô∏è Usando datos de prueba');
                    cargarDatosDePrueba();
                    mostrarNotificacion('‚ö†Ô∏è Modo demostraci√≥n', 'info');
                }

            } finally {
                ocultarLoading();
            }
        }

        async function obtenerDetallesDesdeSheets(userId) {
            try {
                const detallesUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/DetallesUsuarios!A:T?key=${API_KEY}`;
                const detallesResponse = await fetch(detallesUrl);

                if (!detallesResponse.ok) {
                    // Si no hay detalles, retornar valores vac√≠os
                    return obtenerDetallesVacios();
                }

                const detallesData = await detallesResponse.json();
                const detallesRows = detallesData.values || [];

                // Buscar por ID (columna A)
                for (let i = 1; i < detallesRows.length; i++) {
                    const row = detallesRows[i];
                    if (row[0] == userId) {
                        return {
                            nombreCompleto: row[1] || 'Por completar',
                            fechaNacimiento: row[2] || '',
                            telefono: row[3] || '',
                            whatsapp: row[4] || '',
                            departamento: row[5] || 'Beni',
                            ciudad: row[6] || 'Trinidad',
                            institucion: row[7] || 'GDB Beni',
                            carrera: row[8] || '',
                            semestre: row[9] || '',
                            genero: row[10] || '',
                            facebook: row[11] || '',
                            instagram: row[12] || '',
                            biografia: row[13] || 'Perfil en construcci√≥n',
                            intereses: row[15] || '',
                            habilidades: row[16] || '',
                            idiomas: row[17] || 'Espa√±ol'
                        };
                    }
                }

                // Si no encontr√≥ detalles, retornar valores vac√≠os
                return obtenerDetallesVacios();

            } catch (error) {
                console.error('Error obteniendo detalles:', error);
                return obtenerDetallesVacios();
            }
        }
        function obtenerDetallesVacios() {
            return {
                nombreCompleto: 'Por completar',
                fechaNacimiento: '',
                telefono: '',
                whatsapp: '',
                departamento: 'Beni',
                ciudad: 'Trinidad',
                institucion: 'GDB Beni',
                carrera: '',
                semestre: '',
                genero: '',
                facebook: '',
                instagram: '',
                biografia: 'Perfil en construcci√≥n',
                intereses: '',
                habilidades: '',
                idiomas: 'Espa√±ol'
            };
        }

        // ============================================
        // FUNCIONES AUXILIARES
        // ============================================
        function extraerNombreDesdeEmail(email) {
            if (!email) return 'Usuario GDB';

            try {
                let nombre = email.split('@')[0];
                nombre = nombre.replace(/[._-]/g, ' ')
                    .replace(/\d+/g, '')
                    .trim();

                nombre = nombre.split(/\s+/)
                    .filter(palabra => palabra.length > 0)
                    .map(palabra => {
                        if (palabra.length <= 2) return palabra.toLowerCase();
                        return palabra.charAt(0).toUpperCase() + palabra.slice(1).toLowerCase();
                    })
                    .join(' ');

                return nombre || 'Usuario GDB';
            } catch (error) {
                return 'Usuario GDB';
            }
        }

        function obtenerIniciales(nombre) {
            if (!nombre) return 'G';

            const partes = nombre.split(' ');
            if (partes.length >= 2) {
                return (partes[0].charAt(0) + partes[1].charAt(0)).toUpperCase();
            }

            return nombre.charAt(0).toUpperCase();
        }

        function cargarDatosDePrueba() {
            const datosPrueba = {
                id: usuarioActual?.id || "1",
                email: usuarioActual?.email || "usuario@ejemplo.com",
                nombre: usuarioActual?.nombre || "Usuario GDB",
                tipo: usuarioActual?.tipo || "delegado",
                iniciales: usuarioActual?.iniciales || "G",
                fechaRegistro: "2024-01-01",
                ultimoAcceso: new Date().toISOString(),

                // Detalles (vac√≠os o por completar)
                nombreCompleto: "Por completar",
                telefono: "",
                whatsapp: "",
                departamento: "Beni",
                ciudad: "Trinidad",
                institucion: "GDB Beni",
                carrera: "",
                semestre: "",
                genero: "",
                facebook: "",
                instagram: "",
                biografia: "Perfil en construcci√≥n",
                fechaNacimiento: "",
                intereses: "",
                habilidades: "",
                idiomas: "Espa√±ol",

                // Estad√≠sticas VAC√çAS
                estadisticas: {
                    eventosAsistidos: 0,
                    horasVoluntariado: 0,
                    proyectosParticipados: 0,
                    puntosAcumulados: 0,
                    ranking: "Nuevo"
                },

                // Actividades VAC√çAS
                actividadesRecientes: []
            };

            datosUsuarioCompletos = datosPrueba;
            mostrarDatosUsuario(datosPrueba);
            mostrarNotificacion('‚ö†Ô∏è Usando datos de demostraci√≥n', 'info');
        }

        // ============================================
        // MOSTRAR DATOS EN LA INTERFAZ (MANTENER TU C√ìDIGO)
        // ============================================
        function mostrarDatosUsuario(datos) {
            // Actualizar encabezado
            document.getElementById('user-name').textContent = datos.nombre || datos.nombreCompleto || 'Usuario';
            document.getElementById('user-email').textContent = datos.email || '';
            document.getElementById('user-avatar').textContent = datos.iniciales || datos.nombre?.charAt(0).toUpperCase() || 'G';

            // Actualizar perfil principal
            document.getElementById('full-name').textContent = datos.nombreCompleto || datos.nombre || 'Usuario GDB';
            document.getElementById('display-id').textContent = datos.id || '0000';

            // T√≠tulo seg√∫n tipo de usuario
            let titulo = "Miembro GDB";
            if (datos.tipo === 'admin') {
                titulo = "Administrador GDB Beni";
            } else if (datos.tipo === 'delegado') {
                titulo = "Delegado GDB Beni";
            }
            document.getElementById('user-title').textContent = titulo;

            // Avatar grande
            const avatarGrande = document.getElementById('grand-avatar');
            if (datos.iniciales && datos.iniciales.length > 1) {
                avatarGrande.textContent = datos.iniciales;
                avatarGrande.innerHTML = '';
                avatarGrande.textContent = datos.iniciales;
            } else {
                avatarGrande.innerHTML = '<i class="fas fa-user-graduate"></i>';
            }

            // Actualizar datos personales
            actualizarDatosPersonales(datos);

            // Actualizar informaci√≥n de contacto
            actualizarInformacionContacto(datos);

            // Actualizar estad√≠sticas (siempre vac√≠as o reales)
            actualizarEstadisticas(datos.estadisticas || {});
        }

        function actualizarDatosPersonales(datos) {
            const personalDataDiv = document.getElementById('personal-data');

            const datosPersonales = [
                {
                    label: 'ID GDB',
                    value: datos.id || 'No asignado',
                    icon: 'fas fa-id-badge',
                    valorPorDefecto: 'No asignado'
                },
                {
                    label: 'Tipo de Usuario',
                    value: datos.tipo === 'admin' ? 'Administrador' :
                        datos.tipo === 'delegado' ? 'Delegado' : 'Miembro',
                    icon: 'fas fa-user-tag',
                    valorPorDefecto: 'Miembro'
                },
                {
                    label: 'Fecha de Nacimiento',
                    value: datos.fechaNacimiento ? formatearFecha(datos.fechaNacimiento) : 'Por completar',
                    icon: 'fas fa-birthday-cake',
                    valorPorDefecto: 'Por completar'
                },
                {
                    label: 'G√©nero',
                    value: datos.genero || 'Por completar',
                    icon: 'fas fa-venus-mars',
                    valorPorDefecto: 'Por completar'
                },
                {
                    label: 'Departamento',
                    value: datos.departamento || 'Beni',
                    icon: 'fas fa-map-marker-alt',
                    valorPorDefecto: 'Beni'
                },
                {
                    label: 'Instituci√≥n',
                    value: datos.institucion || 'GDB Beni',
                    icon: 'fas fa-university',
                    valorPorDefecto: 'GDB Beni'
                },
                {
                    label: 'Carrera',
                    value: datos.carrera || 'Por completar',
                    icon: 'fas fa-graduation-cap',
                    valorPorDefecto: 'Por completar'
                },
                {
                    label: 'Semestre',
                    value: datos.semestre || 'Por completar',
                    icon: 'fas fa-calendar-alt',
                    valorPorDefecto: 'Por completar'
                }
            ];

            personalDataDiv.innerHTML = datosPersonales.map(item => `
        <div class="dato-item">
            <div class="dato-label">
                <i class="${item.icon}"></i> ${item.label}
            </div>
            <div class="dato-valor ${!item.value || item.value === item.valorPorDefecto ? 'texto-suave' : ''}">
                ${item.value}
            </div>
        </div>
    `).join('');

            // Agregar estilos para texto suave
            const style = document.createElement('style');
            style.textContent = `
        .texto-suave {
            color: var(--medium-gray) !important;
            font-style: italic;
        }
    `;
            document.head.appendChild(style);
        }


        function actualizarInformacionContacto(datos) {
            const contactDataDiv = document.getElementById('contact-data');

            const datosContacto = [
                {
                    label: 'Email',
                    value: datos.email || 'No especificado',
                    icon: 'fas fa-envelope',
                    type: 'email',
                    valorPorDefecto: 'No especificado'
                },
                {
                    label: 'Tel√©fono',
                    value: datos.telefono || 'Por completar',
                    icon: 'fas fa-phone',
                    type: 'tel',
                    valorPorDefecto: 'Por completar'
                },
                {
                    label: 'WhatsApp',
                    value: datos.whatsapp || datos.telefono || 'Por completar',
                    icon: 'fab fa-whatsapp',
                    type: 'whatsapp',
                    valorPorDefecto: 'Por completar'
                },
                {
                    label: 'Facebook',
                    value: datos.facebook || 'Por completar',
                    icon: 'fab fa-facebook',
                    type: 'facebook',
                    valorPorDefecto: 'Por completar'
                },
                {
                    label: 'Instagram',
                    value: datos.instagram || 'Por completar',
                    icon: 'fab fa-instagram',
                    type: 'instagram',
                    valorPorDefecto: 'Por completar'
                }
            ];

            contactDataDiv.innerHTML = datosContacto.map(item => `
        <div class="lista-item">
            <div class="lista-icono">
                <i class="${item.icon}"></i>
            </div>
            <div style="flex-grow: 1;">
                <div style="font-weight: 600; margin-bottom: 5px;">${item.label}</div>
                <div class="${!item.value || item.value === item.valorPorDefecto ? 'texto-suave' : ''}">${item.value}</div>
            </div>
            ${item.value !== 'Por completar' && item.value !== 'No especificado' && item.type !== 'email' ? `
            <a href="${getLinkPorTipo(item.type, item.value)}" target="_blank" 
               class="btn-secondary" style="padding: 8px 15px; font-size: 0.9rem;">
                <i class="fas fa-external-link-alt"></i>
            </a>
            ` : ''}
        </div>
    `).join('');
        }


        function actualizarEstadisticas(stats) {
            // Si no hay estad√≠sticas o est√°n vac√≠as, mostrar ceros
            const eventos = stats?.eventosAsistidos || stats?.eventos || 0;
            const horas = stats?.horasVoluntariado || stats?.horas || 0;
            const proyectos = stats?.proyectosParticipados || stats?.proyectos || 0;

            document.getElementById('stat-events').textContent = eventos;
            document.getElementById('stat-hours').textContent = horas;
            document.getElementById('stat-projects').textContent = proyectos;

            // Ranking siempre ser√° "Nuevo" hasta que se asignen puntos
            document.getElementById('stat-ranking').textContent = '#0';
        }

        function formatearFecha(fechaISO) {
            if (!fechaISO) return '';

            try {
                const fecha = new Date(fechaISO);
                return fecha.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return fechaISO;
            }
        }

        function getLinkPorTipo(tipo, valor) {
            switch (tipo) {
                case 'email': return `mailto:${valor}`;
                case 'tel': return `tel:${valor.replace(/\D/g, '')}`;
                case 'whatsapp':
                    const numero = valor.replace(/\D/g, '');
                    return `https://wa.me/591${numero}`;
                case 'facebook':
                    return valor.includes('http') ? valor : `https://facebook.com/${valor}`;
                case 'instagram':
                    return valor.includes('http') ? valor : `https://instagram.com/${valor.replace('@', '')}`;
                default: return '#';
            }
        }

        // ============================================
        // FUNCIONES DE UI (MANTENER TU C√ìDIGO)
        // ============================================
        function configurarEventos() {
            document.getElementById('logout-btn').addEventListener('click', cerrarSesion);
            document.getElementById('edit-info-btn').addEventListener('click', abrirModalEdicion);
            document.getElementById('save-password-btn').addEventListener('click', cambiarPassword);
            document.getElementById('delete-account-btn').addEventListener('click', eliminarCuenta);

            document.getElementById('edit-modal').addEventListener('click', function (e) {
                if (e.target === this) {
                    cerrarModal();
                }
            });
        }

        function inicializarTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(`tab-${tabId}`).classList.add('active');

                    if (tabId === 'actividades') cargarActividades();
                    if (tabId === 'documentos') cargarDocumentos();
                });
            });
        }

        // ============================================
        // MODAL DE EDICI√ìN (SIMULADO)
        // ============================================
        function abrirModalEdicion() {
            if (!datosUsuarioCompletos) return;

            mostrarNotificacion('‚ö†Ô∏è Edici√≥n disponible pr√≥ximamente', 'info');

            // Por ahora, solo simulamos
            setTimeout(() => {
                mostrarNotificacion('‚úÖ Perfil actualizado (simulaci√≥n)', 'success');
            }, 1000);
        }

        function cerrarModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        function guardarCambios() {
            mostrarNotificacion('‚úÖ Cambios guardados localmente', 'success');
            cerrarModal();
        }

        // ============================================
        // FUNCIONES DE NOTIFICACI√ìN Y LOADING
        // ============================================
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const existente = document.querySelector('.notificacion-flotante');
            if (existente) existente.remove();

            let icono = 'info-circle';
            let color = '#2196F3';

            if (tipo === 'success') { icono = 'check-circle'; color = '#4CAF50'; }
            else if (tipo === 'error') { icono = 'exclamation-circle'; color = '#f44336'; }
            else if (tipo === 'warning') { icono = 'exclamation-triangle'; color = '#FF9800'; }

            const notificacion = document.createElement('div');
            notificacion.className = 'notificacion-flotante';
            notificacion.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px; flex-grow: 1;">
                <i class="fas fa-${icono}" style="font-size: 1.2rem;"></i>
                <span>${mensaje}</span>
            </div>
            <button onclick="this.parentElement.remove()" 
                    style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin-left: 15px;">
                <i class="fas fa-times"></i>
            </button>
        `;

            notificacion.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${color};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            max-width: 500px;
            animation: slideIn 0.3s ease;
        `;

            document.body.appendChild(notificacion);

            setTimeout(() => {
                if (notificacion.parentNode) {
                    notificacion.remove();
                }
            }, 5000);
        }

        function mostrarLoading(mensaje = 'Cargando...') {
            ocultarLoading();

            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            color: white;
            font-size: 1.1rem;
        `;

            overlay.innerHTML = `
            <div class="spinner" style="
                border: 5px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top: 5px solid var(--gold);
                width: 50px;
                height: 50px;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            "></div>
            <div>${mensaje}</div>
        `;

            const style = document.createElement('style');
            style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);
        }

        function ocultarLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Funciones globales
        window.cerrarModal = cerrarModal;
        window.guardarCambios = guardarCambios;

        // Funciones de ejemplo para pesta√±as
        function cargarActividades() {
            const activitiesList = document.getElementById('activities-list');

            activitiesList.innerHTML = `
        <div style="text-align: center; padding: 50px 20px;">
            <i class="fas fa-calendar-plus" style="font-size: 3rem; color: var(--medium-gray); margin-bottom: 20px;"></i>
            <h3 style="color: var(--medium-gray); margin-bottom: 10px;">Sin actividades registradas</h3>
            <p style="color: var(--medium-gray);">Tus actividades aparecer√°n aqu√≠ cuando participes en eventos GDB</p>
        </div>
    `;
        }

        function cargarDocumentos() {
            const documentsList = document.getElementById('documents-list');

            documentsList.innerHTML = `
        <div style="text-align: center; padding: 50px 20px;">
            <i class="fas fa-folder-open" style="font-size: 3rem; color: var(--medium-gray); margin-bottom: 20px;"></i>
            <h3 style="color: var(--medium-gray); margin-bottom: 10px;">Sin documentos</h3>
            <p style="color: var(--medium-gray);">Tus certificados y documentos aparecer√°n aqu√≠ cuando est√©n disponibles</p>
        </div>
    `;
        }

        function cambiarPassword() {
            mostrarNotificacion('‚ö†Ô∏è Cambio de contrase√±a disponible pr√≥ximamente', 'info');
        }

        function eliminarCuenta() {
            mostrarNotificacion('‚ùå Esta funci√≥n no est√° disponible', 'error');
        }
    </script>
</body>

</html>